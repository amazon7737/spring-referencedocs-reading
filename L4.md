## 애플리케이션 레벨에 요청을 받을때, L4에서 일어나는 일에 대해서

L4 전송 게층의 핵심 동작

- L4 계층에는 TCP 와 UDP 프로토콜이 존재한다.
- 클라이언트가 서버로 요청 시, 서버의 IP 주소와 함께 포트 번호가 지정된다. 포트 번호에 따라 서버의 여러 애플리케이션 중 어떤 서비스로 요청이 전달될지 결정된다.
- TCP 는 3-way handshake 과정을 통해 연결을 성립시키고, 신뢰성 있는 데이터 송수신을 보장한다. UDP는 비연결성으로써, 빠르지만 신뢰성이 낮으며 사용자가 직접 요청 구조를 변경할 수 있다.
- 연결이 성립되고 나면, 전송 계층이 데이터의 손실/중복/순서를 관리하며, 여러 애플리케이션 프로세스에 정확한 데이터 전달(프로세스 간 논리적 통신)을 수행한다.

L4 스위칭 관점의 처리
L4 스위치(로드밸런서)는 IP 주소뿐 아니라 포트 번호(80, 443, 8080) 와 프로토콜(TCP/UDP)을 근거로 패킷을 분기하거나 트래픽 분산, 서버 선택 등의 네트워크 처리를 한다.
서버 그룹 앞에 VIP(가상 IP)를 두고 들어온 요청의 목적 포트에 따라 실제 서버로 매핑하여 전달한다.
매 세션마다 소스/목적지 IP, 포트 , 프로토콜 정보를 기반으로 트래픽 경로를 결정한다.

### 처리 과정
1. 클라이언트가 서버에 TCP 연결 요청 (서버 IP 192.168.1.10:80)
2. L4 계층에서 포트 번호, IP와 함께 TCP 연결을 생성(3-way handshake)
3. 연결 정보에 따라 해당 애플리케이션(웹서버)이 요청 패킷을 수신
4. 데이터 송수신 과정에서 L4 계층은 데이터의 신뢰성, 순서, 오류 검증, 흐름 제어 등을 담당
5. 응용 계층으로 데이터가 전달돼 애플리케이션이 실제 요청을 처리하게 됨

### 정리

L4에서는 TCP/UDP 기반의 포트 번호를 활용하여 애플리케이션 간에 논리적 연결을 성립시키고, 신뢰성.순서.오류 검증 등 데이터 전송의 핵심 제어를 담당한다. 네트워크 장비에서는 L4 정보로 트래픽 분배, 서버 선택 등의 분산 처리가 이루어진다.

