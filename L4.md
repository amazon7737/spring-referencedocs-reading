## 애플리케이션 레벨에 요청을 받을때, L4에서 일어나는 일에 대해서

L4 전송 게층의 핵심 동작

- L4 계층에는 TCP 와 UDP 프로토콜이 존재한다.
- 클라이언트가 서버로 요청 시, 서버의 IP 주소와 함께 포트 번호가 지정된다. 포트 번호에 따라 서버의 여러 애플리케이션 중 어떤 서비스로 요청이 전달될지 결정된다.
- TCP 는 3-way handshake 과정을 통해 연결을 성립시키고, 신뢰성 있는 데이터 송수신을 보장한다. UDP는 비연결성으로써, 빠르지만 신뢰성이 낮으며 사용자가 직접 요청 구조를 변경할 수 있다.
- 연결이 성립되고 나면, 전송 계층이 데이터의 손실/중복/순서를 관리하며, 여러 애플리케이션 프로세스에 정확한 데이터 전달(프로세스 간 논리적 통신)을 수행한다.

L4 스위칭 관점의 처리
L4 스위치(로드밸런서)는 IP 주소뿐 아니라 포트 번호(80, 443, 8080) 와 프로토콜(TCP/UDP)을 근거로 패킷을 분기하거나 트래픽 분산, 서버 선택 등의 네트워크 처리를 한다.
서버 그룹 앞에 VIP(가상 IP)를 두고 들어온 요청의 목적 포트에 따라 실제 서버로 매핑하여 전달한다.
매 세션마다 소스/목적지 IP, 포트 , 프로토콜 정보를 기반으로 트래픽 경로를 결정한다.

### 처리 과정
1. 클라이언트가 서버에 TCP 연결 요청 (서버 IP 192.168.1.10:80)
2. L4 계층에서 포트 번호, IP와 함께 TCP 연결을 생성(3-way handshake)
3. 연결 정보에 따라 해당 애플리케이션(웹서버)이 요청 패킷을 수신
4. 데이터 송수신 과정에서 L4 계층은 데이터의 신뢰성, 순서, 오류 검증, 흐름 제어 등을 담당
5. 응용 계층으로 데이터가 전달돼 애플리케이션이 실제 요청을 처리하게 됨

### 정리

L4에서는 TCP/UDP 기반의 포트 번호를 활용하여 애플리케이션 간에 논리적 연결을 성립시키고, 신뢰성.순서.오류 검증 등 데이터 전송의 핵심 제어를 담당한다. 네트워크 장비에서는 L4 정보로 트래픽 분배, 서버 선택 등의 분산 처리가 이루어진다.


## L4 에서의 포트와 소켓 동작
---

L4 에서 포트와 소켓은 네트워크 내 애플리케이션 간 통신을 연결.식별하는 핵심 역할을 한다.

포트의 역할
- 포트는 각 애플리케이션 프로세스를 식별한다 (0~65535 의 숫자로 2byte)
- 같은 서버 내에서 서로 다른 서비스(웹 80, DB 3306, FTP 21)에 대한 요청을 구분해 전달하는 데 사용된다.
- L4 스위치나 네트워크 장비는 IP 주소 + 포트(<IP, Port>) 기반으로 트래픽 분배 및 호출 처리를 수행한다.

소켓의 동작
소켓은 IP 주소와 포트, 프로토콜을 조합한 엔드포인트이다.
서버 쪽에서 지정된 포트에 바인딩하여 연결 요청을 대기(listening socket), 클라이언트는 임시 포트로 서버의 포트에 연결(connect) 시도한다.
서버는 연결을 받아들이면 각 클라이언트의 통신을 관리하기 위한 새로운 소켓(세션)이 생성되어, 독립적으로 데이터 송수신이 이루어진다.
소켓은 메모리 공간에 IP.포트 정보를 저장하며, 각 연결은 핸들값(소켓 핸들)로 관리한다.

### 정리

L4에서 포트는 프로세스의 식별을, 소켓은 연결 세션의 통신 통로 역할을 한다. 이 둘을 결합시켜 개별 요청을 정확하게 구분한다.

## 애플리케이션 서버가 요청을 받기 전에, 이루어지는 네트워크 상의 동작

이번 정리에서는, 애플리케이션 레벨인 WAS가 요청을 받기전에 Web Server에 도달하는 요청을 L4에서 어떤식으로 처리하는지에 대해서 정리해볼 것이다.

<img width="1384" height="415" alt="image" src="https://github.com/user-attachments/assets/1a2d8349-a692-43f1-adf5-5fab8934e0a9" />

